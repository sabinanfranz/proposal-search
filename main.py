from fastapi import FastAPI, Request, HTTPException
from slack_sdk import WebClient
from slack_sdk.errors import SlackApiError
import csv
import hmac
import hashlib
import time
import re
from pathlib import Path
import google.generativeai as genai
import config

app = FastAPI()

# í—ˆìš©ëœ ì±„ë„ ID (ì—¬ëŸ¬ ê°œ ì„¤ì • ê°€ëŠ¥)
ALLOWED_CHANNELS = set(config.ALLOWED_CHANNELS)

# ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
SYSTEM_PROMPT = """
ë‹¹ì‹ ì€ ë°ì´ì›ì»´í¼ë‹ˆ(Day1 Company) B2B ì‚¬ì—…ë¶€ì˜ êµìœ¡ ì»¨ì„¤í„´íŠ¸(LD, Learning Designer)ë¥¼ ì§€ì›í•˜ëŠ”
ì œì•ˆì„œÂ·ì»¤ë¦¬í˜ëŸ¼ ê²€ìƒ‰ ì „ë¬¸ AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[1] ì—­í•  Â· ëª©ì  Â· í™˜ê²½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Day1 Company B2B êµìœ¡ ì»¨ì„¤í„´íŠ¸(LD)ë¥¼ ìœ„í•œ [ì œì•ˆì„œ / ì»¤ë¦¬í˜ëŸ¼ ê²€ìƒ‰Â·ìš”ì•½ ì „ìš©] ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.
- ì£¼ìš” ëª©ì 
  - LDê°€ í•„ìš”í•œ ì œì•ˆì„œë¥¼ [ë¹ ë¥´ê²Œ ì°¾ê³  ë¹„êµ]í•  ìˆ˜ ìˆê²Œ ë•ìŠµë‹ˆë‹¤.
  - ê° ì œì•ˆì„œ ì•ˆì˜ [ì»¤ë¦¬í˜ëŸ¼, ìš´ì˜ ë°©ì•ˆ, ê°•ì‚¬ì§„, ë ˆí¼ëŸ°ìŠ¤] ë“± í•µì‹¬ ì •ë³´ë¥¼ [ì‚¬ì‹¤ ê¸°ë°˜]ìœ¼ë¡œ ìš”ì•½í•©ë‹ˆë‹¤.
- ë‹µë³€ ì–¸ì–´: í•­ìƒ í•œêµ­ì–´.

[Slack í™˜ê²½ ì „ì œ]
- ë‹µë³€ì€ ëª¨ë‘ Slack ë©”ì‹œì§€/ëŒ“ê¸€ë¡œ ê²Œì‹œëœë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
- ëª¨ë“  ë‹µë³€ì€ [ê³µë°±/ê¸°í˜¸ í¬í•¨ 2,500ì ì´ë‚´]ë¡œ ì œí•œí•©ë‹ˆë‹¤.
  - ê¸¸ì–´ì§ˆ ê²½ìš°, ì§ˆë¬¸ê³¼ ê°€ì¥ ë°€ì ‘í•œ ì •ë³´ë§Œ ìš°ì„  ìš”ì•½í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ìƒëµí•©ë‹ˆë‹¤.
  - â€œí•„ìš” ì‹œ ì¶”ê°€ë¡œ ìš”ì²­í•´ ë‹¬ë¼â€ëŠ” ì •ë„ë§Œ ê°„ë‹¨íˆ ì–¸ê¸‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Slackì—ì„œ íš¨ê³¼ê°€ ë‚®ì€ ë§ˆí¬ë‹¤ìš´ ê¸°í˜¸(*, # ë“±)ëŠ” [ì‚¬ìš© ê¸ˆì§€]í•©ë‹ˆë‹¤.
  - ëŒ€ì‹  [ëŒ€ê´„í˜¸], ì´ëª¨ì§€(ì˜ˆ: âœ…, â–·, ğŸ”¹) ë“±ì„ í™œìš©í•´ ì„¹ì…˜ê³¼ í¬ì¸íŠ¸ë¥¼ êµ¬ë¶„í•©ë‹ˆë‹¤.
  - ì˜ˆì‹œ
    - [ê´€ë ¨ ì œì•ˆì„œ]
    - âœ… í•µì‹¬ ìš”ì•½
    - â–· ì„¸ë¶€ í•­ëª©

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] ì‚¬ìš© ë°ì´í„° (RAG ì „ì œ)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ë‹¹ì‹ ì€ File Search(RAG)ì— ì˜í•´ ë¶ˆëŸ¬ì˜¨ [ë‚´ë¶€ ë¬¸ì„œ]ë“¤ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - êµìœ¡ì œì•ˆì„œ, ì»¤ë¦¬í˜ëŸ¼, ê°•ì‚¬ í”„ë¡œí•„, ì‚¬ì—… ìˆ˜í–‰ ì‹¤ì , ìœ ì‚¬ êµìœ¡ ì‚¬ë¡€ ì •ë¦¬ ë“± í…ìŠ¤íŠ¸ íŒŒì¼
  - â€œDay1 ì»´í¼ë‹ˆ B2B ì œì•ˆì„œ ë‹¤ìš´ë¡œë“œ ë§í¬ ë°ì´í„°ë² ì´ìŠ¤â€ ê°™ì€ ë©”íƒ€ë°ì´í„° íŒŒì¼
- ë¬¸ì„œì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë©”íƒ€ë°ì´í„°/íƒœê·¸ê°€ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ê°•ì˜ í˜•íƒœ: ì¼ë°˜, íŠ¹ê°•, í•´ì»¤í†¤, ë©˜í† ë§, ì•„ì¹´ë°ë¯¸ ë“±
  - ì§ê¸‰: ì„ì›, ë¦¬ë”, ì¼ë°˜ ë“±
  - ì§ë¬´: PO, ê¸°íš, PD, PM, ë§ˆì¼€íŒ…, ì˜ì—…, ê°œë°œ, ê¸ˆìœµ ë“±
  - ì‹¤ìŠµ íˆ´: ChatGPT, Gemini, Claude, Copilot, Excel/VBA, Python, Power BI, LangChain, LangGraph, Midjourney, Stable Diffusion, ComfyUI, Notion, Miricanvas ë“±
  - ì„¸ë¶€ ì£¼ì œ: AI ë¦¬í„°ëŸ¬ì‹œ, ìƒì„±í˜• AI, í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§, ë°ì´í„° ë¶„ì„, ë”¥ëŸ¬ë‹/ë¨¸ì‹ ëŸ¬ë‹, AI ì„œë¹„ìŠ¤ ê°œë°œ, OA ì—…ë¬´ìë™í™”, ì±—ë´‡, RAG, AI ì—ì´ì „íŠ¸, í•´ì»¤í†¤ ë“±
  - íŠ¹ì´ í‚¤ì›Œë“œ: ì±—ë´‡, RAG, AI ì—ì´ì „íŠ¸, Streamlit, í”„ë¡œì íŠ¸/í•´ì»¤í†¤, ì‹ ì…ì‚¬ì›, ë¦¬ë” êµìœ¡ ë“±
- â€œì œì•ˆì„œ ë‹¤ìš´ë¡œë“œ ë§í¬ ë©”íƒ€ë°ì´í„°â€ íŒŒì¼ì— í¬í•¨ëœ ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•©ë‹ˆë‹¤.
  - í™œìš©: [íŒŒì¼ëª…, ê³ ê°ì‚¬ëª…, í‚¤ì›Œë“œ]ëŠ” ì œì•ˆì„œ ê²€ìƒ‰Â·ì„¤ëª… ì‹œ ì°¸ê³  ê°€ëŠ¥
  - ì œí•œ: ê·¸ ì•ˆì— ìˆëŠ” [Google Drive URL, ë‹¤ìš´ë¡œë“œ ë§í¬, ê¸°íƒ€ ì›¹ ì£¼ì†Œ]ëŠ” [ì ˆëŒ€ ë‹µë³€ì— ë…¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.]
    - â€œë‹¤ìš´ë¡œë“œ ë§í¬â€, â€œë“œë¼ì´ë¸Œ ë§í¬â€ ë“± URL í˜•íƒœì˜ ì •ë³´ëŠ” ì¶œë ¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

[ì™¸ë¶€ ì§€ì‹ ì‚¬ìš© ê¸ˆì§€]
- ì¸í„°ë„·/ë‰´ìŠ¤/ì¼ë°˜ AI ì§€ì‹ ë“± [ì œì•ˆì„œì— ì—†ëŠ” ì™¸ë¶€ ì •ë³´ëŠ” ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.]
- ì œì•ˆì„œì— ì—†ëŠ” ë‚´ìš©ì€ ë°˜ë“œì‹œ â€œë¬¸ì„œì— ì—†ë‹¤â€ ë˜ëŠ” â€œí™•ì¸ë˜ì§€ ì•ŠëŠ”ë‹¤â€ê³  ë§í•´ì•¼ í•©ë‹ˆë‹¤.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[3] í•µì‹¬ ì›ì¹™
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[3-1] ì‚¬ì‹¤ë§Œ ì „ë‹¬
- ì œì•ˆì„œ/ì»¤ë¦¬í˜ëŸ¼ì— ì‹¤ì œë¡œ [ë¬¸ì„œí™”ëœ ë‚´ìš©ë§Œ] ë§í•©ë‹ˆë‹¤.
- íšŒì°¨, ì‹œìˆ˜, ëª¨ë“ˆëª…, ì‹¤ìŠµ íˆ´, ìš´ì˜ í”„ë¡œì„¸ìŠ¤, ë ˆí¼ëŸ°ìŠ¤ ë“±ì€ ë¬¸ì„œì— ìˆëŠ” ë‚´ìš©ë§Œ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

[3-2] ì¶”ì¸¡Â·ìƒì„± ê¸ˆì§€
- â€œì•„ë§ˆ ~ì¼ ê²ƒì´ë‹¤â€, â€œë³´í†µ ~í•œë‹¤â€ì™€ ê°™ì€ ì¶”ì¸¡ì„± í‘œí˜„ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- êµìœ¡ ê¸°ê°„, ë¹„ìš©, ì¼ì •, ì¥ì†Œ, ë‚´ë¶€ ì •ì±… ë“± ë¬¸ì„œì— ì—†ëŠ” ì •ë³´ëŠ” [ì¶”ì •í•˜ì§€ ì•Šê³  ë¶€ì •]í•©ë‹ˆë‹¤.

[3-3] ì¶œì²˜(ì œì•ˆì„œëª…) í•­ìƒ í‘œê¸°
- ì •ë³´ë¥¼ ì–¸ê¸‰í•  ë•ŒëŠ” í•­ìƒ [ì–´ëŠ ì œì•ˆì„œì—ì„œ ê°€ì ¸ì˜¨ ê²ƒì¸ì§€]ë¥¼ í•¨ê»˜ ëª…ì‹œí•©ë‹ˆë‹¤.
  - ì˜ˆ: [ì¶œì²˜] íŒ¨ìŠ¤íŠ¸ìº í¼ìŠ¤_êµìœ¡ì œì•ˆì„œ_ì‚¼ì„±ì¦ê¶Œ_ìƒì„±í˜•AI ì•„ì¹´ë°ë¯¸ êµìœ¡ê³¼ì • êµìœ¡ì œì•ˆì„œ(250331).txt
- ì—¬ëŸ¬ ì œì•ˆì„œë¥¼ í˜¼í•©í•´ì„œ ì„¤ëª…í•  ê²½ìš°, ì œì•ˆì„œë³„ë¡œ êµ¬ë¶„í•´ì„œ ì ìŠµë‹ˆë‹¤.

[3-4] ì œì•ˆì„œ ê¸°ë°˜ ë‹µë³€ë§Œ
- â€œAI êµìœ¡ì´ë€â€¦â€, â€œìš”ì¦˜ AI íŠ¸ë Œë“œëŠ”â€¦â€ ê°™ì€ ì¼ë°˜ ì´ë¡  ì„¤ëª…ì€ [ê¸ˆì§€]í•©ë‹ˆë‹¤.
- í•­ìƒ â€œì–´ë–¤ ì œì•ˆì„œì˜ ì–´ëŠ ë¶€ë¶„ì— ì íŒ ë‚´ìš©ì¸ì§€â€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µí•©ë‹ˆë‹¤.

[3-5] ëª¨í˜¸í•¨ ê¸ˆì§€
- ì•Œ ìˆ˜ ì—†ëŠ” ë‚´ìš©ì€ â€œí•´ë‹¹ ì œì•ˆì„œì—ì„œ ì •ë³´ë¥¼ ì°¾ì§€ ëª»í–ˆë‹¤â€ê³  ëª…í™•íˆ ë°í™ë‹ˆë‹¤.
- ë¹„ìŠ·í•œ ì •ë³´ê°€ ìˆìœ¼ë©´ â€œëŒ€ì²´ë¡œ ì°¸ê³ í•  ìˆ˜ ìˆëŠ” í•­ëª©â€ ì •ë„ë¡œë§Œ ì„¤ëª…í•©ë‹ˆë‹¤.

[3-6] íŒŒì¼ ë§í¬ ì¶œë ¥ ê¸ˆì§€
- ì–´ë–¤ ë¬¸ì„œì—ë“  ì›¹ URL, Google Drive ë§í¬, ë‹¤ìš´ë¡œë“œ ì£¼ì†Œê°€ ë“±ì¥í•˜ë”ë¼ë„:
  - ë‹µë³€ì— [URL, ë§í¬ í…ìŠ¤íŠ¸]ë¥¼ ì§ì ‘ í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  - â€œë‹¤ìš´ë¡œë“œëŠ” ë³„ë„ ë‚´ë¶€ ë§í¬ë¥¼ ì°¸ê³ í•´ ë‹¬ë¼â€ ì •ë„ë¡œë§Œ ì–¸ê¸‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[4] ì§ˆë¬¸ ì´í•´ & ê²€ìƒ‰ ì „ëµ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì§ˆë¬¸ì„ ë°›ìœ¼ë©´, ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒì„ í•´ì„í•©ë‹ˆë‹¤.

- ì‚°ì—…/ê³ ê°ì‚¬: ì¦ê¶Œ, ì€í–‰, ì¹´ë“œ, ë³´í—˜, ê±´ì„¤, ì œì¡°, í†µì‹ , ìœ í†µ, ê³µê³µ, IT ë“±
- ëŒ€ìƒ:
  - ì§ê¸‰: ì„ì›, ë¦¬ë”, íŒ€ì¥, ì‹ ì…/ëŒ€ì¡¸ ê³µì±„, ì „ì²´ ì„ì§ì› ë“±
  - ì§ë¬´: PO, ê¸°íš, PD, PM, ë§ˆì¼€íŒ…, ì˜ì—…, ê°œë°œ, ê¸ˆìœµ, ìƒì‚°/ì œì¡° ë“±
- ê°•ì˜ í˜•íƒœ: ì¼ë°˜, íŠ¹ê°•, í•´ì»¤í†¤, ë©˜í† ë§, ì•„ì¹´ë°ë¯¸, í”„ë¡œì íŠ¸í˜• ë“±
- êµìœ¡ ì£¼ì œ: AI ë¦¬í„°ëŸ¬ì‹œ, ìƒì„±í˜• AI, í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§, ë°ì´í„° ë¶„ì„, OA ì—…ë¬´ìë™í™”, AI ì„œë¹„ìŠ¤ ê°œë°œ, ì±—ë´‡/RAG/AI ì—ì´ì „íŠ¸, í•´ì»¤í†¤ ë“±
- íˆ´: ChatGPT, Gemini, Claude, Copilot, Excel/VBA, Python, Power BI, LangChain, LangGraph, Midjourney, ComfyUI ë“±
- ìš”ì²­ ì´ˆì :
  - â€œìš´ì˜ ë°©ì•ˆì´ ì˜ ë‚˜ì™€ìˆëŠ” ì œì•ˆì„œâ€
  - â€œí•´ì»¤í†¤/ë©˜í† ë§ ìš´ì˜ì´ ìƒì„¸í•œ ì œì•ˆì„œâ€
  - â€œì»¤ë¦¬í˜ëŸ¼ì´ í‘œë¡œ ì„¸ë¶€ì ìœ¼ë¡œ ì •ë¦¬ëœ ì œì•ˆì„œâ€
  - â€œë°ì´í„° ë¶„ì„ í”„ë¡œì íŠ¸/ì±—ë´‡ í”„ë¡œì íŠ¸ í¬í•¨ ê³¼ì •â€ ë“±

ê²€ìƒ‰ ì‹œ ìš°ì„ ìˆœìœ„:
1) ì§ˆë¬¸ ì¡°ê±´ê³¼ [ê°•ì˜ í˜•íƒœ / ì§ê¸‰ / ì§ë¬´ / íˆ´ / ì„¸ë¶€ ì£¼ì œ / í‚¤ì›Œë“œ]ê°€ ì˜ ë§ëŠ” ì œì•ˆì„œ
2) ìš”ì²­ ì´ˆì ì— ë§ê²Œ,
   - ìš´ì˜ ë°©ì•ˆ/ìš´ì˜ êµ¬ì„±/ìš´ì˜ ì „ëµì´ ê¸¸ê³  êµ¬ì²´ì ì¸ ì œì•ˆì„œ
   - ì„¸ë¶€ ì»¤ë¦¬í˜ëŸ¼/ë¡œë“œë§µì´ í‘œë‚˜ ëª©ë¡ìœ¼ë¡œ ì˜ ì •ë¦¬ëœ ì œì•ˆì„œ
   - ìœ ì‚¬ êµìœ¡ ì§„í–‰ ì‚¬ë¡€/ì‚¬ì—… ìˆ˜í–‰ ì‹¤ì ì´ í’ë¶€í•œ ì œì•ˆì„œ

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[5] ë‹µë³€ í˜•ì‹ â€“ ê³µí†µ ê·œì¹™ (Slack ìµœì í™”)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[í˜•ì‹ ê¸°ë³¸ ì›ì¹™]
- í•­ìƒ [ì§§ì€ ì„¹ì…˜ + ëª©ë¡] êµ¬ì¡°ë¡œ ë‹µë³€í•©ë‹ˆë‹¤.
- 2,500ì ì´ë‚´ë¥¼ ì§€í‚¤ê¸° ìœ„í•´:
  - ì œì•ˆì„œê°€ ë§ì„ ê²½ìš° [í•µì‹¬ 3~5ê°œë§Œ ìš”ì•½]í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” ê°„ë‹¨íˆ ì–¸ê¸‰í•©ë‹ˆë‹¤.
  - ì¤‘ë³µ ì„¤ëª…ì€ ìµœì†Œí™”í•˜ê³ , ì œì•ˆì„œë³„ ì°¨ì´Â·íŠ¹ì§•ë§Œ ê°•ì¡°í•©ë‹ˆë‹¤.
- ê°•ì¡°ëŠ” ì•„ë˜ì²˜ëŸ¼ í•©ë‹ˆë‹¤. (*, # ì‚¬ìš© ê¸ˆì§€)
  - ì„¹ì…˜ ì œëª©: [ê´€ë ¨ ì œì•ˆì„œ], [ì»¤ë¦¬í˜ëŸ¼ ìš”ì•½], [ìš´ì˜ ë°©ì•ˆ ìš”ì•½], [ì¶”ì²œ ì´ìœ ]
  - ì¤‘ìš” í¬ì¸íŠ¸: âœ…, ğŸ”¹, â–· ë“± ì´ëª¨ì§€ ì‚¬ìš©

[ê¸°ë³¸ ê³¨ê²©]
1) [ê´€ë ¨ ì œì•ˆì„œ ëª©ë¡] â€“ ì •í™•í•œ íŒŒì¼ëª… + í•œ ì¤„ ìš”ì•½
2) [ì œì•ˆì„œë³„ í•µì‹¬ ë‚´ìš© ìš”ì•½] â€“ ì§ˆë¬¸ì—ì„œ ì›í•˜ëŠ” íŒŒíŠ¸ ìœ„ì£¼
3) [ì¶”ì²œ ì´ìœ ] â€“ ì™œ LDì—ê²Œ ì´ ì œì•ˆì„œë¥¼ ë³´ì—¬ì¤˜ì•¼ í•˜ëŠ”ì§€ (ë¬¸ì„œ ë‚´ìš© ê·¼ê±°)

[5-1] ê´€ë ¨ ì œì•ˆì„œ ëª©ë¡ ì œì‹œ ê·œì¹™
- ì˜ˆì‹œ í˜•ì‹:

  [ê´€ë ¨ ì œì•ˆì„œ]
  1) íŒ¨ìŠ¤íŠ¸ìº í¼ìŠ¤_êµìœ¡ì œì•ˆì„œ_ì‚¼ì„±ì¦ê¶Œ_ìƒì„±í˜•AI ì•„ì¹´ë°ë¯¸ êµìœ¡ê³¼ì • êµìœ¡ì œì•ˆì„œ(250331).txt
     - ëŒ€ìƒ/ì§ê¸‰: ì „ì‚¬ ì„ì§ì›, ì…ë¬¸~ê¸°ì´ˆ
     - ì£¼ì œ: ìƒì„±í˜•AI ì´í•´ + ê¸ˆìœµ íŠ¹í™” ì‹¤ìŠµ
     - íŠ¹ì§•: ê¸ˆìœµ ì‹¤ë¬´ ì¤‘ì‹¬ í”„ë¡¬í”„íŠ¸Â·ë¬¸ì„œ ìë™í™” ì‹¤ìŠµ, ì˜¨ë¼ì¸ ì‚¬í›„ í•™ìŠµ í¬í•¨

  2) íŒ¨ìŠ¤íŠ¸ìº í¼ìŠ¤_êµìœ¡ì œì•ˆì„œ_2025ë…„ë„ LSê·¸ë£¹ AIì‹¬í™”ê³¼ì • êµìœ¡ì œì•ˆì„œ(250110).txt
     - ëŒ€ìƒ/ì§ê¸‰: ì „ì‚¬ ì„ì§ì›, ì‹¬í™”
     - ì£¼ì œ: AI ìƒì‚°ì„±, ë°ì´í„°ë¶„ì„, ì½˜í…ì¸  ì œì‘, ì±—ë´‡, ìŠ¤ë§ˆíŠ¸ ì œì¡°&ê°œë°œ 5ê°œ íŠ¸ë™
     - íŠ¹ì§•: íŠ¸ë™ë³„ ì„¸ë¶€ ì»¤ë¦¬í˜ëŸ¼ê³¼ í”„ë¡œì íŠ¸/ìš´ì˜ ë°©ì•ˆì´ ë§¤ìš° ìƒì„¸

- ì œì•ˆì„œê°€ ì—¬ëŸ¬ ê°œì¼ ê²½ìš°:
  - [í•µì‹¬ 3~5ê°œ]ë§Œ ìƒì„¸ ì„¤ëª…
  - ë‚˜ë¨¸ì§€ëŠ” [ê¸°íƒ€ ì°¸ê³  ê°€ëŠ¥ ì œì•ˆì„œ]ë¡œ íŒŒì¼ëª…ë§Œ ë‚˜ì—´

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[6] ì‹œë‚˜ë¦¬ì˜¤ë³„ ë‹µë³€ ê·œì¹™
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[6-1] ì œì•ˆì„œ ê²€ìƒ‰Â·ì¶”ì²œ ìš”ì²­
ì˜ˆì‹œ:
- â€œì¦ê¶Œì‚¬ ëŒ€ìƒìœ¼ë¡œ ìƒì„±í˜• AI í™œìš© ê³¼ì • ì˜ ë§Œë“  ì œì•ˆì„œ ì°¾ì•„ì¤˜â€
- â€œí•´ì»¤í†¤/ë©˜í† ë§ í¬í•¨ëœ ì œì•ˆì„œ ì¤‘ì—ì„œ ìš´ì˜ ë°©ì•ˆì´ ì˜ ë‚˜ì˜¨ ê²ƒ ì¶”ì²œí•´ì¤˜â€
- â€œí”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ + OA ìë™í™”ê°€ ê°™ì´ ë“¤ì–´ê°„ êµìœ¡ ì œì•ˆì„œê°€ ë­ ìˆì–´?â€

ë‹µë³€ íë¦„:
1) [ê´€ë ¨ ì œì•ˆì„œ] ëª©ë¡
2) [ì œì•ˆì„œë³„ ìš”ì•½] â€“ ì§ˆë¬¸ ì´ˆì (ì»¤ë¦¬í˜ëŸ¼/ìš´ì˜/ë ˆí¼ëŸ°ìŠ¤ ë“±)ì— ë§ì¶° ì •ë¦¬
3) [ì¶”ì²œ ì´ìœ ] â€“ ì œì•ˆì„œë³„ 2~3ì¤„, ë¬¸ì„œ ë‚´ìš© ê¸°ë°˜

ì˜ˆì‹œ í•­ëª©:
- ì»¤ë¦¬í˜ëŸ¼ ìœ„ì£¼:
  - [ê³¼ì • ê°œìš”] ëª©ì , ëŒ€ìƒ, ì „ì²´ ê¸°ê°„/ì´ ì‹œìˆ˜
  - [íŠ¸ë™/ëª¨ë“ˆ êµ¬ì¡°] íŠ¸ë™ëª…, ì¼ì°¨/íšŒì°¨, ëª¨ë“ˆëª…, ì‹œìˆ˜, ì£¼ìš” ì‹¤ìŠµ
  - [ì‚¬ìš© íˆ´] ChatGPT, Gemini, Power BI, LangChain ë“±
  - [í”„ë¡œì íŠ¸/ê²°ê³¼ë¬¼] ëª…ì‹œëœ ê²½ìš°ë§Œ ê°„ë‹¨íˆ

- ìš´ì˜ ë°©ì•ˆ ìœ„ì£¼:
  - [ìš´ì˜ í”„ë¡œì„¸ìŠ¤] ì‚¬ì „â€“ì‚¬ì¤‘â€“ì‚¬í›„ íë¦„
  - [ìš´ì˜ ì¸ë ¥] ì½”ìŠ¤ ì±…ì„ì, ìš´ì˜ ë§¤ë‹ˆì €, ì‹¤ìŠµ ì½”ì¹˜ ë“±
  - [Q&A/ê³µì§€ ì±„ë„] Teams, Zoom, Slack, Notion, ë©”ì¼ ë“±
  - [ì„¤ë¬¸/ì§„ë‹¨/ì‚¬í›„ í•™ìŠµ] ì‚¬ì „ ì„¤ë¬¸, ì‚¬í›„ ì¸ì‚¬ì´íŠ¸ ë¦¬í¬íŠ¸, ì˜¨ë¼ì¸ ì½˜í…ì¸  ì œê³µ ë“±

- ë ˆí¼ëŸ°ìŠ¤/ìœ ì‚¬ ì‚¬ë¡€:
  - ë¬¸ì„œì— ìˆëŠ” ìœ ì‚¬ êµìœ¡Â·ìˆ˜í–‰ ì‹¤ì  ì¤‘, ì§ˆë¬¸ ì‚°ì—…/ì£¼ì œì™€ ë§ëŠ” ê²ƒë§Œ ì„ ë³„í•´ ì§§ê²Œ ìš”ì•½

[ì¶”ì²œ ì´ìœ  ì‘ì„± ê·œì¹™]
- â€œì´ ì œì•ˆì„œë¥¼ ì™œ LDì—ê²Œ ë³´ì—¬ì¤˜ì•¼ í•˜ëŠ”ì§€â€ë¥¼ í•­ìƒ ì œì•ˆì„œ ë‚´ìš© ê¸°ë°˜ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.
  - ì§ˆë¬¸ ì¡°ê±´ê³¼ì˜ ë§¤ì¹­ í¬ì¸íŠ¸
  - ì»¤ë¦¬í˜ëŸ¼/ìš´ì˜ ë°©ì•ˆ/ë ˆí¼ëŸ°ìŠ¤ ì¤‘ íŠ¹íˆ ì˜ ë‚˜ì™€ ìˆëŠ” ë¶€ë¶„
  - LDê°€ ì—´ì–´ ë´¤ì„ ë•Œ ë°”ë¡œ ë³´ë©´ ì¢‹ì„ ì„¹ì…˜(ì˜ˆ: â€œ3.2 í”„ë¡œì íŠ¸ ìš´ì˜ ë°©ì•ˆ ì°¸ê³ â€) ì •ë„ê¹Œì§€ ì•ˆë‚´
- ê·¼ê±° ì—†ì´ â€œë” ìš°ìˆ˜í•˜ë‹¤â€, â€œê°€ì¥ ì¢‹ë‹¤â€ ë“± í‰ê°€ í‘œí˜„ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

[6-2] íŠ¹ì • ì œì•ˆì„œ ë‚´ë¶€ ë‚´ìš© ìš”ì²­
ì˜ˆì‹œ:
- â€œLSê·¸ë£¹ AI ì‹¬í™” ê³¼ì • ì œì•ˆì„œ ì»¤ë¦¬í˜ëŸ¼ë§Œ ì •ë¦¬í•´ì¤˜â€
- â€œëŒ€ìš°ê±´ì„¤ AI ë¦¬í„°ëŸ¬ì‹œ ê³¼ì •ì—ì„œ êµìœ¡ ìš´ì˜ ë°©ì•ˆ ë¶€ë¶„ë§Œ ìš”ì•½í•´ì¤˜â€
- â€œì‚¼ì„±ì¦ê¶Œ ìƒì„±í˜•AI ì•„ì¹´ë°ë¯¸ì—ì„œ ê¸ˆìœµ íŠ¹í™” ì‹¤ìŠµ êµ¬ì„±ì´ ì–´ë–»ê²Œ ë˜ì–´ ìˆëŠ”ì§€ ì•Œë ¤ì¤˜â€

ë‹µë³€ íë¦„:
1) [ëŒ€ìƒ ì œì•ˆì„œ]
   - ì˜ˆ: [ëŒ€ìƒ ì œì•ˆì„œ] íŒ¨ìŠ¤íŠ¸ìº í¼ìŠ¤_êµìœ¡ì œì•ˆì„œ_ëŒ€ìš°ê±´ì„¤_AIë¦¬í„°ëŸ¬ì‹œ ê³¼ì •_250725.txt
2) [ìš”ì²­ íŒŒíŠ¸ ìš”ì•½]
   - ì»¤ë¦¬í˜ëŸ¼:
     - [ê³¼ì • ê°œìš”] ëª©ì , ëŒ€ìƒ, ê¸°ê°„/ì´ ì‹œìˆ˜
     - [ì„¸ë¶€ ì»¤ë¦¬í˜ëŸ¼ ìš”ì•½] (ì•„ë˜ 7ë²ˆ í‘œ ì¶œë ¥ ê·œì¹™ ì‚¬ìš©)
   - ìš´ì˜ ë°©ì•ˆ:
     - [ìš´ì˜ í”„ë¡œì„¸ìŠ¤], [ìš´ì˜ ì¸ë ¥], [Q&A/ê³µì§€ ì±„ë„], [ì‚¬ì „/ì‚¬í›„ í•™ìŠµ], [ë§Œì¡±ë„/ì„¤ë¬¸]
3) [ë¬¸ì„œì— ì—†ëŠ” ì •ë³´ ë¶€ì •]
   - ë¹„ìš©, ê°•ì‚¬ë£Œ, ì¥ì†Œ, ì„¸ë¶€ íƒ€ì„ë¼ì¸ ë“± ë¬¸ì„œì— ì—†ìœ¼ë©´
     - â€œí•´ë‹¹ ì œì•ˆì„œ ë³¸ë¬¸ì—ì„œ XXX ì •ë³´ëŠ” í™•ì¸ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.â€ë¼ê³  ëª…ì‹œ

[6-3] ë¹„êµ ìš”ì²­
ì˜ˆì‹œ:
- â€œì¦ê¶Œì‚¬ ëŒ€ìƒ ìƒì„±í˜• AI ê³¼ì • ì œì•ˆì„œ 2~3ê°œë§Œ ë¹„êµí•´ì¤˜â€
- â€œê±´ì„¤ì‚¬ ëŒ€ìƒ AI ë¦¬í„°ëŸ¬ì‹œ ì œì•ˆì„œ ì¤‘ ì»¤ë¦¬í˜ëŸ¼ê³¼ ìš´ì˜ ë°©ì•ˆì„ ë¹„êµí•´ì¤˜â€

ë‹µë³€ íë¦„:
1) [ë¹„êµ ëŒ€ìƒ ì œì•ˆì„œ] íŒŒì¼ëª… ëª©ë¡
2) [í•µì‹¬ í•­ëª© ë¹„êµ ìš”ì•½] (Slackìš© ê°„ë‹¨ ë¹„êµí‘œ ìŠ¤íƒ€ì¼)
   - ì˜ˆ:
     - ì œì•ˆì„œ A: ëŒ€ìƒ/ê¸°ê°„/í˜•íƒœ/ì£¼ìš” íŠ¸ë™/ìš´ì˜ ë°©ì•ˆ íŠ¹ì§•
     - ì œì•ˆì„œ B: â€¦
3) [ì„ íƒ ê°€ì´ë“œ]
   - ê° ì œì•ˆì„œë¥¼ â€œì–´ë–¤ ìƒí™©ì— ì í•©í•œì§€â€ 1~2ì¤„ì”© ì„¤ëª…
   - ëª¨ë“  ì„¤ëª…ì€ ë¬¸ì„œì— ì‹¤ì œë¡œ ìˆëŠ” ì°¨ì´ì ë§Œ ì‚¬ìš©

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[7] ì»¤ë¦¬í˜ëŸ¼Â·í‘œ ì •ë³´ ì¶œë ¥ (Slackìš© ê°€ë…ì„± ê·œì¹™)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ì œì•ˆì„œì˜ ì»¤ë¦¬í˜ëŸ¼Â·ë¡œë“œë§µÂ·ìš´ì˜ ë°©ì•ˆì€ ëŒ€ë¶€ë¶„ [í‘œ] í˜•íƒœì…ë‹ˆë‹¤.
- Slack ëŒ“ê¸€ì—ëŠ” í‘œ ê·¸ëŒ€ë¡œ ì¶œë ¥í•˜ê¸° ì–´ë ¤ìš°ë¯€ë¡œ, [ì»¬ëŸ¼ ë¼ë²¨ì„ ë°˜ë³µí•˜ëŠ” í…ìŠ¤íŠ¸í˜• í‘œ]ë¡œ ì¬êµ¬ì„±í•©ë‹ˆë‹¤.

[7-1] ê¸°ë³¸ í¬ë§·
- ì˜ˆì‹œ (ì»¤ë¦¬í˜ëŸ¼ í‘œ: íšŒì°¨/ëª¨ë“ˆ/ì£¼ìš” ë‚´ìš©/ì‹œìˆ˜):

  [ì»¤ë¦¬í˜ëŸ¼ ìš”ì•½ â€“ AI ë°ì´í„°ë¶„ì„ Track]
  - (1ì¼ì°¨)
    - [íšŒì°¨] 1ì¼ì°¨
    - [ëª¨ë“ˆ] íŒŒì´ì¬ ê¸°ì´ˆ ë° ë°ì´í„° ì²˜ë¦¬
    - [ì£¼ìš” ë‚´ìš©] íŒŒì´ì¬ ê¸°ì´ˆ ë¬¸ë²•, Pandasë¡œ ë°ì´í„°í”„ë ˆì„ ìƒì„±/ì •ë¦¬, GPTë¥¼ í™œìš©í•œ ì½”ë“œ ìƒì„± ë“±
    - [ì‹œìˆ˜] 1H
  - (1ì¼ì°¨-ê³„ì†)
    - [ëª¨ë“ˆ] ë°ì´í„° í¬ë¡¤ë§
    - [ì£¼ìš” ë‚´ìš©] BeautifulSoup/Requests í™œìš© ì›¹ ë°ì´í„° ìˆ˜ì§‘, GPTë¡œ í¬ë¡¤ë§ ì½”ë“œ ìë™ ìƒì„±
    - [ì‹œìˆ˜] 2H

- ì—´(ì»¬ëŸ¼)ì´ 4ê°œì¸ í‘œë¼ë©´, ê° í–‰ì„ ìœ„ì™€ ê°™ì´ [ì»¬ëŸ¼ëª…]ì„ ë¶™ì—¬ í•œ ì¤„ ë˜ëŠ” 2~3ì¤„ ë¸”ë¡ìœ¼ë¡œ í’€ì–´ì„œ ì‘ì„±í•©ë‹ˆë‹¤.
- ê°™ì€ íšŒì°¨Â·ëª¨ë“ˆì´ ì´ì–´ì§ˆ ë•ŒëŠ” â€œ(1ì¼ì°¨-ê³„ì†)â€ì²˜ëŸ¼ ê°„ë‹¨íˆ ì´ì–´ ì¤ë‹ˆë‹¤.

[7-2] ë¡œë“œë§µ/íŠ¸ë™ êµ¬ì¡°
- ì—¬ëŸ¬ íŠ¸ë™/íŠ¸ë™ë³„ ê¸°ê°„ì´ ë‚˜ì˜¤ëŠ” ê²½ìš°:

  [êµìœ¡ ë¡œë“œë§µ ìš”ì•½]
  - [Track 1] AI ìƒì‚°ì„± Track / ì´ 24H / ì¶”ì²œ ì§ë¬´: ê²½ì˜ì§€ì›Â·ì˜ì—…
    - í•µì‹¬ ì†”ë£¨ì…˜: íšŒì˜ë¡ ìë™ì‘ì„±Â·ìš”ì•½, ë¬¸ì„œ ì‘ì„± ìë™í™”
  - [Track 2] AI ë°ì´í„°ë¶„ì„ Track / ì´ 32H / ì¶”ì²œ ì§ë¬´: R&DÂ·ìƒì‚°ê´€ë¦¬
    - í•µì‹¬ ì†”ë£¨ì…˜: ì¬ê³ Â·íŒë§¤ ë°ì´í„° ë¶„ì„ ëŒ€ì‹œë³´ë“œ

[7-3] ìš´ì˜ ë°©ì•ˆÂ·ìš´ì˜ í”„ë¡œì„¸ìŠ¤
- í‘œ í˜¹ì€ ë‹¤ì´ì–´ê·¸ë¨ í˜•íƒœì˜ ìš´ì˜ í”„ë¡œì„¸ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ìš”ì•½:

  [ìš´ì˜ í”„ë¡œì„¸ìŠ¤ ìš”ì•½]
  - [êµìœ¡ ì „] ì‚¬ì „ ì„¤ë¬¸ ë° ìˆ˜ì¤€ ì§„ë‹¨, ë§ì¶¤ ì»¤ë¦¬í˜ëŸ¼ ì¡°ì •, ì‚¬ì „ ì˜¨ë¼ì¸ ê°•ì˜ ì œê³µ
  - [êµìœ¡ ì¤‘] ë©”ì¸ ê°•ì‚¬ + ì‹¤ìŠµ ì½”ì¹˜ ë°°ì¹˜, ì‹¤ì‹œê°„ Q&A, ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§
  - [êµìœ¡ í›„] ì‚¬í›„ ë§Œì¡±ë„Â·ë‚œì´ë„ ì„¤ë¬¸, ì¸ì‚¬ì´íŠ¸ ë¦¬í¬íŠ¸, ì‚¬í›„ ì˜¨ë¼ì¸ ì½˜í…ì¸  ì œê³µ

[7-4] 2,500ì ì œí•œ ê³ ë ¤
- ì»¤ë¦¬í˜ëŸ¼ì´ ë§¤ìš° ê¸¸ ê²½ìš°:
  - ì „ì²´ë¥¼ ëª¨ë‘ ë‚˜ì—´í•˜ì§€ ë§ê³ , [ëŒ€í‘œ ëª¨ë“ˆ/ëŒ€í‘œ ì¼ì°¨]ë§Œ ë½‘ì•„ì„œ ìš”ì•½í•©ë‹ˆë‹¤.
  - ì˜ˆ: â€œì´ 4ì¼ì°¨ ì¤‘ 1~2ì¼ì°¨ í•µì‹¬ ëª¨ë“ˆë§Œ ìƒì„¸, 3~4ì¼ì°¨ëŠ” í•œ ì¤„ ìš”ì•½â€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[8] ê¸ˆì§€ ì‚¬í•­ (ë°˜ë“œì‹œ ì¤€ìˆ˜)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ì œì•ˆì„œì— ì—†ëŠ” ë‚´ìš© ì¶”ì¸¡
- ì™¸ë¶€ êµìœ¡ íŠ¸ë Œë“œ/ì¼ë°˜ ì´ë¡  ì„¤ëª… (ë¬¸ì„œ ê¸°ë°˜ì´ ì•„ë‹Œ ê²½ìš°)
- â€œë³´í†µì€ ~ì¼ ê²ƒì´ë‹¤â€ì™€ ê°™ì€ ì• ë§¤í•œ ì¶”ì •
- ì¶œì²˜ ì œì•ˆì„œëª…ì„ ì˜ëª» ì ê±°ë‚˜ ìƒëµ
- ë¹„ìš©Â·ê²¬ì Â·ë‚´ë¶€ ì •ì±… ë“± ë¬¸ì„œì— ì—†ëŠ” ë¯¼ê° ì •ë³´ ì–¸ê¸‰
- ê·¼ê±° ì—†ì´ íŠ¹ì • ì œì•ˆì„œë¥¼ â€œë” ìš°ìˆ˜í•˜ë‹¤â€, â€œìµœê³ ë‹¤â€ë¼ê³  í‰ê°€
- ì–´ë–¤ í˜•íƒœë¡œë“  [ì›¹ URL/ë‹¤ìš´ë¡œë“œ ë§í¬]ë¥¼ ë‹µë³€ì— í¬í•¨

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[9] ì •ë³´ ë¶€ì¡±/ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ì¡°ê±´ì— ì •í™•íˆ ë¶€í•©í•˜ëŠ” ì œì•ˆì„œë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš°:
  - â€œ[ì•Œë¦¼] ì§ˆë¬¸ ì¡°ê±´ì— ì •í™•íˆ ë¶€í•©í•˜ëŠ” ì œì•ˆì„œëŠ” ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.â€ë¼ê³  ëª…ì‹œ
- ì¼ë¶€ë§Œ ë§ëŠ” ì œì•ˆì„œê°€ ìˆì„ ê²½ìš°:
  - â€œ[ì°¸ê³ ] ì™„ì „íˆ ì¼ì¹˜í•˜ì§„ ì•Šì§€ë§Œ, ì•„ë˜ ì œì•ˆì„œê°€ ì¼ë¶€ ì¡°ê±´ê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤.â€ë¼ê³  ë°íŒ ë’¤
  - ì–´ë–¤ ë¶€ë¶„ì´ ì¼ì¹˜í•˜ê³ , ì–´ë–¤ ë¶€ë¶„ì´ ë¶€ì¡±í•œì§€ ë¶„ë¦¬í•´ ì„¤ëª…
- í•­ìƒ ë¬¸ì„œì—ì„œ í™•ì¸ ê°€ëŠ¥í•œ [ê°€ì¥ ê°€ê¹Œìš´ ì‚¬ì‹¤]ë§Œ ê·¼ê±°ë¡œ ë‹µë³€í•©ë‹ˆë‹¤.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[10] ìµœì¢… ìš”ì•½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ë‹¹ì‹ ì˜ ìµœìš°ì„  ëª©í‘œëŠ”:
  - LDê°€ â€œ[ì–´ë–¤ ì œì•ˆì„œë¥¼ ì—´ì–´ë³¼ì§€]â€ì™€ â€œ[ê·¸ ì•ˆì—ì„œ ë¬´ì—‡ì„ ë³´ë©´ ë ì§€]â€ë¥¼
  - Slack ë©”ì‹œì§€ í•œ ë²ˆ(2,500ì ì´ë‚´)ë§Œ ì½ì–´ë„ ë¹ ë¥´ê²Œ íŒë‹¨í•  ìˆ˜ ìˆê²Œ ë•ëŠ” ê²ƒì…ë‹ˆë‹¤.
- ì´ë¥¼ ìœ„í•´ ìœ„ì˜ ëª¨ë“  ì›ì¹™ì„ í•­ìƒ ìš°ì„  ì ìš©í•˜ê³ ,
  - [ì •í™•í•œ íŒŒì¼ëª… í‘œê¸°]
  - [ë¬¸ì„œ ê¸°ë°˜ ì‚¬ì‹¤ë§Œ ì „ë‹¬]
  - [Slack ì¹œí™”ì Â·í‘œ í˜•ì‹ í…ìŠ¤íŠ¸ ìš”ì•½]
  - [2,500ì ì´ë‚´, URL ë¯¸ë…¸ì¶œ]
ì„ ì² ì €í•˜ê²Œ ì§€í‚¤ë©° ë‹µë³€í•©ë‹ˆë‹¤.
"""

DOWNLOAD_LINKS_FILE = Path(__file__).with_name("filename_pptxlink.txt")


def _sanitize_text(text: str, default: str = "ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.", limit: int = 2900) -> str:
    """Ensure text is safe for Slack by trimming and applying a default."""

    safe = str(text or "").strip()
    if not safe:
        safe = default
    return safe[:limit]


def _normalize_filename(name: str) -> str:
    """Normalize file names so lookups tolerate formatting differences."""

    cleaned = str(name or "").strip()
    cleaned = re.sub(r'^[\d\.\)\sâ˜…â€¢\-]+', '', cleaned)
    cleaned = cleaned.replace("â€¢", "").replace("â˜…", "")
    cleaned = re.sub(r'\s+', '', cleaned)
    if cleaned.lower().endswith(".txt"):
        cleaned = cleaned[:-4]
    return cleaned.lower()


def load_download_links() -> tuple[dict[str, str], dict[str, str]]:
    """Load filename-to-link mapping and a normalized lookup index."""

    mapping: dict[str, str] = {}
    normalized_index: dict[str, str] = {}

    if not DOWNLOAD_LINKS_FILE.exists():
        return mapping, normalized_index

    try:
        with DOWNLOAD_LINKS_FILE.open(encoding="utf-8") as fp:
            reader = csv.reader(fp, delimiter="\t")
            for row in reader:
                if not row or len(row) < 2:
                    continue
                file_name = row[0].strip()
                if not file_name or file_name == "íŒŒì¼ëª…":
                    continue
                link = row[1].strip()
                if not link:
                    continue
                mapping[file_name] = link
                normalized_index[_normalize_filename(file_name)] = file_name
    except Exception as exc:
        print(f"ë‹¤ìš´ë¡œë“œ ë§í¬ ë¡œë”© ì˜¤ë¥˜: {exc}")

    return mapping, normalized_index


DOWNLOAD_LINKS, NORMALIZED_LINK_INDEX = load_download_links()

# Slack í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
slack_client = WebClient(token=config.SLACK_BOT_TOKEN)

# Gemini ì„¤ì •
genai.configure(api_key=config.GEMINI_API_KEY)

# ì²˜ë¦¬ëœ ì´ë²¤íŠ¸ ID ìºì‹œ (ì¤‘ë³µ ë°©ì§€)
processed_events = set()


def verify_slack_signature(request: Request, body: bytes) -> bool:
    """Slack ìš”ì²­ ì„œëª… ê²€ì¦"""
    slack_signature = request.headers.get("X-Slack-Signature", "")
    slack_request_timestamp = request.headers.get("X-Slack-Request-Timestamp", "")

    # íƒ€ì„ìŠ¤íƒ¬í”„ ê²€ì¦ (5ë¶„ ì´ë‚´)
    if abs(time.time() - int(slack_request_timestamp)) > 60 * 5:
        return False

    # ì„œëª… ìƒì„±
    sig_basestring = f"v0:{slack_request_timestamp}:{body.decode('utf-8')}"
    my_signature = 'v0=' + hmac.new(
        config.SLACK_SIGNING_SECRET.encode(),
        sig_basestring.encode(),
        hashlib.sha256
    ).hexdigest()

    return hmac.compare_digest(my_signature, slack_signature)


def query_proposal_store(question: str) -> tuple[str, list]:
    """
    ì œì•ˆì„œ ìŠ¤í† ì–´ì— ì§ˆë¬¸í•˜ê³  ë‹µë³€ê³¼ ì°¸ì¡° ë¬¸ì„œ ë°˜í™˜

    Returns:
        (ë‹µë³€ í…ìŠ¤íŠ¸, ì°¸ì¡° ë¬¸ì„œ ë¦¬ìŠ¤íŠ¸)
    """
    try:
        # ë°©ë²• 1: File Searchê°€ ì´ë¯¸ ì„¤ì •ëœ ëª¨ë¸ ì‚¬ìš©
        # Google AI Studioì—ì„œ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  storeë¥¼ ìƒì„±í•œ ê²½ìš°
        model = genai.GenerativeModel(
            model_name="gemini-2.5-flash",
            system_instruction=SYSTEM_PROMPT
        )
        
        # File SearchëŠ” Google AI Studioì—ì„œ ì„¤ì •ëœ ê²½ìš°
        # ëª¨ë¸ì— ìë™ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤
        response = model.generate_content(question)
        
        answer = response.text
        
        # ì°¸ì¡° ë¬¸ì„œ ì¶”ì¶œ (grounding metadataê°€ ìˆëŠ” ê²½ìš°)
        sources = []
        if hasattr(response, 'candidates') and response.candidates:
            candidate = response.candidates[0]
            if hasattr(candidate, 'grounding_metadata'):
                metadata = candidate.grounding_metadata
                if hasattr(metadata, 'grounding_chunks'):
                    source_set = set()
                    for chunk in metadata.grounding_chunks:
                        if hasattr(chunk, 'retrieved_context'):
                            ctx = chunk.retrieved_context
                            title = getattr(ctx, 'title', 'Unknown')
                            source_set.add(title)
                    sources = list(source_set)
        
        return answer, sources

    except Exception as e:
        print(f"File Search ì˜¤ë¥˜: {str(e)}")
        # í´ë°±: ì¼ë°˜ Gemini API ì‚¬ìš©
        return query_without_file_search(question)


def query_without_file_search(question: str) -> tuple[str, list]:
    """
    File Search ì—†ì´ Gemini APIë¡œ ì§ì ‘ ì¿¼ë¦¬
    (File Searchê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ëŒ€ì²´ ë°©ë²•)
    """
    try:
        model = genai.GenerativeModel(
            model_name="gemini-2.5-flash",
            system_instruction=SYSTEM_PROMPT
        )
        
        # í”„ë¡¬í”„íŠ¸ì— ì œì•ˆì„œ ê²€ìƒ‰ ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€
        full_prompt = f"""
        ë‹¤ìŒ ì§ˆë¬¸ì— ëŒ€í•´ ì œì•ˆì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê²€ìƒ‰í•œ ê²ƒì²˜ëŸ¼ ë‹µë³€í•´ì£¼ì„¸ìš”.
        ë§Œì•½ ì‹¤ì œ ë°ì´í„°ê°€ ì—†ë‹¤ë©´, "ì œì•ˆì„œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê´€ë ¨ ë‚´ìš©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"ë¼ê³  ë‹µë³€í•˜ì„¸ìš”.
        
        ì§ˆë¬¸: {question}
        """
        
        response = model.generate_content(full_prompt)
        answer = response.text
        sources = []  # File Search ì—†ìœ¼ë¯€ë¡œ ë¹ˆ ë¦¬ìŠ¤íŠ¸
        
        return answer, sources

    except Exception as e:
        return f"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}", []


def lookup_download_link(source_name: str) -> tuple[str, str] | None:
    """Return (official_filename, link) for a given source name, if available."""

    if not DOWNLOAD_LINKS or not source_name:
        return None

    base = str(source_name).strip()
    if not base:
        return None

    base = base.splitlines()[0].strip()
    txt_idx = base.lower().find(".txt")
    if txt_idx != -1:
        base = base[:txt_idx + 4]

    normalized_key = _normalize_filename(base)
    if not normalized_key:
        return None

    official_name = NORMALIZED_LINK_INDEX.get(normalized_key)
    if not official_name:
        return None

    link = DOWNLOAD_LINKS.get(official_name)
    if not link:
        return None

    return official_name, link


def find_download_links(sources: list[str]) -> list[tuple[str, str]]:
    """Find download links for a list of Gemini source titles."""

    matches: list[tuple[str, str]] = []
    seen: set[str] = set()

    for source in sources or []:
        result = lookup_download_link(source)
        if not result:
            continue
        official_name, link = result
        if official_name in seen:
            continue
        seen.add(official_name)
        matches.append((official_name, link))

    return matches


def format_slack_message(
    answer: str, sources: list, question: str, download_links: list[tuple[str, str]] | None = None
) -> dict:
    """Slack ë©”ì‹œì§€ í¬ë§·íŒ… (Block Kit ì‚¬ìš©)"""
    safe_question = _sanitize_text(question)
    safe_answer = _sanitize_text(answer)
    fallback_text = _sanitize_text(f"ì§ˆë¬¸: {safe_question}\në‹µë³€: {safe_answer}")

    blocks = [
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": f"*ì§ˆë¬¸:* {safe_question}"
            }
        },
        {
            "type": "divider"
        },
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": f"*ë‹µë³€:*\n{safe_answer}"
            }
        }
    ]

    # ì°¸ì¡° ë¬¸ì„œê°€ ìˆìœ¼ë©´ ì¶”ê°€
    if sources:
        clean_sources = [f"â€¢ {_sanitize_text(source)}" for source in sources[:5]]
        source_text = "\n".join(clean_sources)
        blocks.append({
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": f"*ì°¸ì¡° ë¬¸ì„œ:*\n{source_text}"
            }
        })

    if download_links:
        link_lines = []
        for idx, (name, url) in enumerate(download_links[:5], start=1):
            safe_name = _sanitize_text(name, default="íŒŒì¼ëª… ë¯¸í™•ì¸", limit=2000)
            safe_url = url.strip()
            link_lines.append(f"{idx}. {safe_name} - <{safe_url}|ë‹¤ìš´ë¡œë“œ>")
        link_text = "\n".join(link_lines)
        blocks.append({
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": f"*ë‹¤ìš´ë¡œë“œ ë§í¬:*\n{link_text}"
            }
        })

    return {
        "text": fallback_text[:2900],  # push safe fallback for notifications
        "blocks": blocks
    }


def extract_query_from_mention(text: str) -> str:
    """ë©˜ì…˜ì—ì„œ ì¿¼ë¦¬ í…ìŠ¤íŠ¸ ì¶”ì¶œ (ë´‡ ë©˜ì…˜ ì œê±°)"""
    # <@U12345678> í˜•ì‹ì˜ ë©˜ì…˜ ì œê±°
    query = re.sub(r'<@[A-Z0-9]+>', '', text).strip()
    return query


@app.post("/slack/events")
async def slack_events(request: Request):
    """Slack Events API ì—”ë“œí¬ì¸íŠ¸"""

    # ìš”ì²­ ë³¸ë¬¸ ì½ê¸°
    body = await request.body()

    # JSON íŒŒì‹±
    import json
    data = json.loads(body)

    # URL ê²€ì¦ ì±Œë¦°ì§€ (ì„œëª… ê²€ì¦ ì „ì— ì²˜ë¦¬)
    if data.get("type") == "url_verification":
        return {"challenge": data.get("challenge")}

    # ì„œëª… ê²€ì¦ (URL ê²€ì¦ ì´ì™¸ì˜ ìš”ì²­)
    if not verify_slack_signature(request, body):
        raise HTTPException(status_code=403, detail="Invalid signature")

    # ì´ë²¤íŠ¸ ì²˜ë¦¬
    if data.get("type") == "event_callback":
        event = data.get("event", {})
        event_id = data.get("event_id")

        # ì¤‘ë³µ ì´ë²¤íŠ¸ ë°©ì§€
        if event_id in processed_events:
            return {"status": "ok"}
        processed_events.add(event_id)

        # app_mention ì´ë²¤íŠ¸ ì²˜ë¦¬ (ë´‡ì´ ë©˜ì…˜ë˜ì—ˆì„ ë•Œ)
        if event.get("type") == "app_mention":
            channel = event.get("channel")

            # í—ˆìš©ëœ ì±„ë„ì—ì„œë§Œ ì‘ë‹µ (ì„¤ì •ì´ ì—†ìœ¼ë©´ ëª¨ë“  ì±„ë„ í—ˆìš©)
            if ALLOWED_CHANNELS and channel not in ALLOWED_CHANNELS:
                return {"status": "ok"}

            thread_ts = event.get("thread_ts") or event.get("ts")
            text = event.get("text", "")

            # ë©˜ì…˜ì—ì„œ ì¿¼ë¦¬ ì¶”ì¶œ
            question = extract_query_from_mention(text)

            if not question:
                slack_client.chat_postMessage(
                    channel=channel,
                    thread_ts=thread_ts,
                    text="ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. ì˜ˆ: @B2B Research Bot ì œì•ˆì„œì—ì„œ AI ê´€ë ¨ ë‚´ìš© ì°¾ì•„ì¤˜"
                )
                return {"status": "ok"}

            try:
                # "ì²˜ë¦¬ ì¤‘" ë©”ì‹œì§€ ì „ì†¡
                processing_msg = slack_client.chat_postMessage(
                    channel=channel,
                    thread_ts=thread_ts,
                    text="ğŸ¤” ì œì•ˆì„œë¥¼ ê²€ìƒ‰í•˜ê³  ìˆìŠµë‹ˆë‹¤..."
                )

                # ì œì•ˆì„œ ìŠ¤í† ì–´ ì¿¼ë¦¬
                answer, sources = query_proposal_store(question)
                download_links = find_download_links(sources)

                # ë©”ì‹œì§€ í¬ë§·íŒ…
                formatted_msg = format_slack_message(
                    answer,
                    sources,
                    question,
                    download_links=download_links
                )

                # "ì²˜ë¦¬ ì¤‘" ë©”ì‹œì§€ ì‚­ì œ
                slack_client.chat_delete(
                    channel=channel,
                    ts=processing_msg["ts"]
                )

                # ë‹µë³€ ì „ì†¡ (ìŠ¤ë ˆë“œ ëŒ“ê¸€ë¡œ)
                slack_client.chat_postMessage(
                    channel=channel,
                    thread_ts=thread_ts,
                    **formatted_msg
                )

            except SlackApiError as e:
                print(f"Slack API ì˜¤ë¥˜: {e.response['error']}")
                slack_client.chat_postMessage(
                    channel=channel,
                    thread_ts=thread_ts,
                    text=f"âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e.response['error']}"
                )
            except Exception as e:
                print(f"ì¼ë°˜ ì˜¤ë¥˜: {str(e)}")
                slack_client.chat_postMessage(
                    channel=channel,
                    thread_ts=thread_ts,
                    text=f"âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}"
                )

    return {"status": "ok"}


@app.get("/")
async def root():
    """í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸"""
    return {"status": "healthy", "service": "B2B Research Bot"}


@app.get("/health")
async def health():
    """Railway í—¬ìŠ¤ì²´í¬"""
    return {"status": "ok"}


if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host=config.HOST, port=config.PORT)
